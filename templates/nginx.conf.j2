# This file was generated by Ae for {{ansible_fqdn}}
# Do NOT modify this file by hand!

{% if grafana_nginx_ssl_redirect -%}
# Redirect HTTP to SSL
server {
    listen 80;
    server_name {{grafana_nginx_servername}};
    rewrite ^(.*) https://$host$1 permanent;
}
{% endif %}

server {
    listen            {{grafana_nginx_port}};
    server_name       {{grafana_nginx_servername}};
    client_max_body_size 8m;
    ignore_invalid_headers off;

{% if grafana_nginx_ssl %}
    ssl on;
    ssl_certificate {{ grafana_nginx_ssl_crt }};
    ssl_certificate_key {{ grafana_nginx_ssl_key }};
{% endif %}

    location / {
        proxy_pass http://127.0.0.1:{{grafana_http_port}};
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_set_header Host $http_host;

    }

    error_log         {{grafana_logs}}/nginx-error.log;
    access_log        {{grafana_logs}}/nginx-access.log;

}
